<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Pro v8 - Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        body { font-family: 'Outfit', sans-serif; background-color: #020617; color: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        .card { background: #1e293b; border-radius: 1.5rem; border: 1px solid #334155; }
        .input-pro { background: #0f172a; border: 1px solid #334155; color: white; padding: 10px; border-radius: 0.75rem; width: 100%; font-size: 16px; }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 12px; color: #64748b; }
        .nav-btn.active { color: #3b82f6; border-bottom: 3px solid #3b82f6; }
        .sticky-header { position: sticky; top: 0; z-index: 100; background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid #1e293b; }
        .checkbox-custom { width: 24px; height: 24px; border-radius: 6px; border: 2px solid #475569; appearance: none; cursor: pointer; position: relative; }
        .checkbox-custom:checked { background-color: #10b981; border-color: #10b981; }
        .checkbox-custom:checked::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: white; font-size: 14px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    </style>
</head>
<body class="pb-28">

    <header class="sticky-header p-5">
        <div class="max-w-md mx-auto flex justify-between items-end">
            <div>
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-1">Tiszta pénzed (Fizetendők után)</p>
                <h1 id="top-final-money" class="text-3xl font-extrabold text-white">0 Ft</h1>
            </div>
            <div class="text-right">
                <p id="label-daily" class="text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-1">Ma költhető</p>
                <div id="top-daily-limit" class="text-xl font-bold text-emerald-400 font-mono">0 Ft</div>
            </div>
        </div>
    </header>

    <main class="p-4 max-w-md mx-auto space-y-6">

        <div id="view-main" class="space-y-6">
            <section class="card p-5">
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2 space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 ml-1 italic">Fizetés + Meglévő</label>
                        <input type="number" id="val-salary" oninput="calculate()" class="input-pro text-xl font-bold text-blue-400" placeholder="0">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 ml-1 italic">Készpénz</label>
                        <input type="number" id="val-cash" oninput="calculate()" class="input-pro" placeholder="0">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 ml-1 italic">Célösszeg</label>
                        <input type="number" id="val-target" oninput="calculate()" class="input-pro" placeholder="3500000">
                    </div>
                </div>
            </section>

            <section class="card p-5 bg-slate-800/50">
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400 italic text-xs uppercase font-bold">Fizetés napja:</span>
                        <div class="flex items-center gap-2">
                            <input type="number" id="val-payday" oninput="calculate()" class="w-10 bg-slate-950 text-center rounded text-white py-1 border border-slate-700" value="10">
                            <span id="display-days-left" class="font-bold text-blue-300 uppercase text-[10px]">0 nap</span>
                        </div>
                    </div>
                    <div class="flex justify-between pt-2 border-t border-slate-700">
                        <span class="text-slate-400 text-xs uppercase font-bold">Még fizetendő fixek:</span>
                        <span id="display-fixed-sum" class="font-bold text-red-400">0 Ft</span>
                    </div>
                </div>
            </section>

            <section class="card p-5 border-l-4 border-red-500">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-[10px] font-black text-red-500 uppercase tracking-widest italic">Havi Fixek</h2>
                    <span class="text-[9px] text-slate-500 uppercase font-black">Fizetve?</span>
                </div>
                <div id="list-expenses" class="space-y-2 mb-4"></div>
                <button onclick="addExpense()" class="w-full py-2 border-2 border-dashed border-slate-700 rounded-xl text-slate-500 text-[10px] font-bold uppercase tracking-widest">+ Új számla</button>
            </section>
        </div>

        <div id="view-mom" class="hidden space-y-6">
            <section class="card p-5 border-t-4 border-orange-500">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold italic text-orange-400">Anyu</h2>
                    <input type="number" id="val-mom-base" oninput="calculate()" class="w-24 bg-transparent border-b border-orange-500 text-right font-black text-orange-400 text-xl focus:outline-none" value="100800">
                </div>
                <div class="bg-emerald-500/5 p-4 rounded-2xl border border-emerald-500/20 mb-6">
                    <div class="flex gap-2">
                        <input type="number" id="input-quick" class="input-pro border-emerald-500/40 text-emerald-400 text-center text-xl font-bold" placeholder="Összeg...">
                        <button onclick="quickAdd()" class="bg-emerald-600 px-6 rounded-xl text-white shadow-lg"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
                <div id="list-mom-refunds" class="space-y-1 divide-y divide-slate-800"></div>
                <div class="mt-6 p-4 bg-slate-950 rounded-2xl border border-slate-800 flex justify-between items-center">
                    <span id="display-mom-final" class="text-lg font-black text-orange-500 italic">0 Ft</span>
                    <span id="display-refund-sum" class="text-lg font-black text-emerald-500 italic">0 Ft</span>
                </div>
            </section>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 h-20 bg-slate-950 border-t border-slate-800 flex z-50">
        <button onclick="setTab('main')" id="nav-main" class="nav-btn active">
            <i class="fas fa-wallet text-xl mb-1"></i><span class="text-[9px] font-bold uppercase">Költségvetés</span>
        </button>
        <button onclick="setTab('mom')" id="nav-mom" class="nav-btn">
            <i class="fas fa-hand-holding-heart text-xl mb-1"></i><span class="text-[9px] font-bold uppercase">Anyu</span>
        </button>
    </nav>

    <script>
        let db = JSON.parse(localStorage.getItem('fin_v8_final')) || {
            salary: 0, cash: 0, target: 3500000, payday: 10, momBase: 100800,
            expenses: [{id: 1, n: 'Telekom', v: 31000, paid: false}, {id: 2, n: 'Émász', v: 50000, paid: false}],
            refunds: []
        };

        function quickAdd() {
            const v = Number(document.getElementById('input-quick').value);
            if(v > 0) {
                db.refunds.unshift({id: Date.now(), v: v, d: new Date().toLocaleTimeString('hu-HU',{hour:'2-digit', minute:'2-digit'})});
                document.getElementById('input-quick').value = '';
                render();
            }
        }

        function setTab(t) {
            document.getElementById('view-main').classList.toggle('hidden', t !== 'main');
            document.getElementById('view-mom').classList.toggle('hidden', t !== 'mom');
            document.getElementById('nav-main').classList.toggle('active', t === 'main');
            document.getElementById('nav-mom').classList.toggle('active', t === 'mom');
        }

        function addExpense() { db.expenses.push({id: Date.now(), n: '', v: 0, paid: false}); render(); }
        function remove(id, type) { db[type] = db[type].filter(x => x.id !== id); calculate(); render(); }
        
        function togglePaid(id) {
            const ex = db.expenses.find(x => x.id === id);
            if(ex) ex.paid = !ex.paid;
            calculate();
        }

        function calculate() {
            db.salary = Number(document.getElementById('val-salary').value);
            db.cash = Number(document.getElementById('val-cash').value);
            db.target = Number(document.getElementById('val-target').value);
            db.payday = Number(document.getElementById('val-payday').value);
            db.momBase = Number(document.getElementById('val-mom-base').value);

            db.expenses.forEach(ex => {
                ex.n = document.getElementById(`ex-n-${ex.id}`).value;
                ex.v = Number(document.getElementById(`ex-v-${ex.id}`).value);
                ex.paid = document.getElementById(`ex-p-${ex.id}`).checked;
            });

            const now = new Date();
            let targetDate = new Date(now.getFullYear(), now.getMonth(), db.payday);
            if(now.getDate() >= db.payday) targetDate = new Date(now.getFullYear(), now.getMonth()+1, db.payday);
            const daysLeft = Math.max(1, Math.ceil((targetDate - now) / (1000 * 60 * 60 * 24)));

            const totalWealth = db.salary + db.cash; 
            const totalRefunds = db.refunds.reduce((s,i) => s + i.v, 0); 
            const momFinal = Math.max(0, db.momBase - totalRefunds); 
            
            // KULCS: Csak azt vonjuk le, ami NINCS fizetve
            const unpaidFixedSum = db.expenses.reduce((s,i) => s + (i.paid ? 0 : i.v), 0) + momFinal; 

            const finalCleanMoney = totalWealth - unpaidFixedSum;
            const diffFromTarget = finalCleanMoney - db.target;
            
            // MODOSITVA: Mostantól MINDIG a (Tiszta pénz - Célösszeg) / Napok alapján számol
            // Akkor is, ha ez negatív (vagyis még nincs meg a cél).
            let daily = Math.floor(diffFromTarget / daysLeft);

            document.getElementById('top-final-money').innerText = finalCleanMoney.toLocaleString() + ' Ft';
            document.getElementById('top-daily-limit').innerText = daily.toLocaleString() + ' Ft';
            document.getElementById('display-days-left').innerText = daysLeft + ' NAP';
            document.getElementById('display-fixed-sum').innerText = unpaidFixedSum.toLocaleString() + ' Ft';
            document.getElementById('display-mom-final').innerText = "Anyu: " + momFinal.toLocaleString() + " Ft";
            document.getElementById('display-refund-sum').innerText = "Vissza: " + totalRefunds.toLocaleString() + " Ft";
            
            localStorage.setItem('fin_v8_final', JSON.stringify(db));
        }

        function render() {
            document.getElementById('val-salary').value = db.salary || '';
            document.getElementById('val-cash').value = db.cash || '';
            document.getElementById('val-target').value = db.target || '';
            document.getElementById('val-payday').value = db.payday || '';
            document.getElementById('val-mom-base').value = db.momBase || '';

            const exCont = document.getElementById('list-expenses');
            exCont.innerHTML = db.expenses.map(ex => `
                <div class="flex gap-2 items-center bg-slate-900/40 p-1 rounded-xl">
                    <input type="checkbox" id="ex-p-${ex.id}" ${ex.paid ? 'checked' : ''} onchange="calculate()" class="checkbox-custom ml-1">
                    <input type="text" id="ex-n-${ex.id}" value="${ex.n}" oninput="calculate()" class="input-pro text-xs py-2 border-none bg-transparent" placeholder="Név">
                    <input type="number" id="ex-v-${ex.id}" value="${ex.v}" oninput="calculate()" class="input-pro w-20 text-right py-2 font-bold ${ex.paid ? 'text-slate-500' : 'text-red-400'} border-none bg-transparent" placeholder="0">
                    <button onclick="remove(${ex.id}, 'expenses')" class="text-slate-700 px-2 text-xs">✕</button>
                </div>
            `).join('');

            const refCont = document.getElementById('list-mom-refunds');
            refCont.innerHTML = db.refunds.map(ref => `
                <div class="flex justify-between items-center py-3 border-slate-800">
                    <span class="text-[10px] text-slate-500 font-mono italic">${ref.d}</span>
                    <span class="text-emerald-400 font-black">+ ${ref.v.toLocaleString()} Ft</span>
                    <button onclick="remove(${ref.id}, 'refunds')" class="text-slate-700 text-[10px] font-bold">TÖRÖL</button>
                </div>
            `).join('');

            calculate();
        }

        document.getElementById('input-quick').addEventListener('keypress', (e) => { if(e.key === 'Enter') quickAdd(); });
        window.onload = render;
    </script>
</body>
</html>
